!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FlowQuery=t():e.FlowQuery=t()}(self,(()=>(()=>{"use strict";var e={7474:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function o(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}a((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(7056));t.default=class{constructor(e=null){if(null===e||""===e)throw new Error("Statement cannot be null or empty");const t=(new i.default).parse(e);this.first=t.firstChild(),this.last=t.lastChild()}run(){return n(this,void 0,void 0,(function*(){return new Promise(((e,t)=>n(this,void 0,void 0,(function*(){try{yield this.first.run(),yield this.first.finish(),e()}catch(e){t(e)}}))))}))}get results(){return this.last.results}}},610:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(7474)),i=n(r(2312)),u=n(r(5517));s.default.listFunctions=function(e){return i.default.listFunctions(e)},s.default.getFunctionMetadata=function(e){return i.default.getMetadata(e)},s.default.Function=u.default,t.default=s.default},5859:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(e){super(),this.alias=e}toString(){return`Alias (${this.alias})`}getAlias(){return this.alias}value(){return this.alias}}t.default=i},4275:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.AliasOption=void 0,function(e){e[e.NOT_ALLOWED=0]="NOT_ALLOWED",e[e.OPTIONAL=1]="OPTIONAL",e[e.REQUIRED=2]="REQUIRED"}(r||(t.AliasOption=r={}))},1542:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this._parent=null,this.children=[]}addChild(e){e._parent=this,this.children.push(e)}firstChild(){if(0===this.children.length)throw new Error("Expected child");return this.children[0]}lastChild(){if(0===this.children.length)throw new Error("Expected child");return this.children[this.children.length-1]}getChildren(){return this.children}childCount(){return this.children.length}value(){return null}isOperator(){return!1}isOperand(){return!this.isOperator()}get precedence(){return 0}get leftAssociative(){return!1}print(){return Array.from(this._print(0)).join("\n")}*_print(e){0===e?yield this.constructor.name:e>0&&(yield"-".repeat(e)+` ${this.toString()}`);for(const t of this.children)yield*t._print(e+1)}toString(){return this.constructor.name}}},3738:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(7847)),i=n(r(3479));t.default=class{constructor(){this.tokens=[],this.tokenIndex=0}tokenize(e){this.tokens=new i.default(e).tokenize(),this.tokenIndex=0}setNextToken(){this.tokenIndex++}peek(){return this.tokenIndex+1>=this.tokens.length?null:this.tokens[this.tokenIndex+1]}ahead(e,t=!0){let r=0;for(let n=this.tokenIndex;n<this.tokens.length;n++)if(!t||!this.tokens[n].isWhitespaceOrComment()){if(!this.tokens[n].equals(e[r]))return!1;if(r++,r===e.length)break}return r===e.length}get token(){return this.tokenIndex>=this.tokens.length?s.default.EOF:this.tokens[this.tokenIndex]}get previousToken(){return this.tokenIndex-1<0?s.default.EOF:this.tokens[this.tokenIndex-1]}}},3840:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(){super()}}t.default=i},970:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(){super()}value(){return this.children[0].value()}}t.default=i},9798:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(){super()}value(){return this.firstChild().value()||{}}}t.default=i},5956:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(){super()}}t.default=i},8587:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(){super()}}t.default=i},440:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(){super()}}t.default=i},2457:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(){super()}}t.default=i},9056:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.stack=[]}push(e){this.stack.push(e)}pop(){return this.stack.pop()}containsType(e){return this.stack.some((t=>t instanceof e))}}},122:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{addKeyValue(e){this.addChild(e)}toString(){return"AssociativeArray"}*_value(){for(const e of this.children){const t=e;yield{[t.key]:t._value}}}value(){return Object.assign({},...this._value())}}t.default=i},1363:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{addValue(e){this.addChild(e)}value(){return this.children.map((e=>e.value()))}}t.default=i},2073:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542)),i=n(r(3198));class u extends s.default{constructor(e,t){super(),this.addChild(new i.default(e)),this.addChild(t)}get key(){return this.children[0].value()}get _value(){return this.children[1].value()}toString(){return"KeyValuePair"}}t.default=u},9997:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(){super()}set index(e){this.addChild(e)}get index(){return this.children[0]}set variable(e){this.addChild(e)}get variable(){return this.children[1]}isOperand(){return!0}value(){return this.variable.value()[this.index.value()]}}t.default=i},3399:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(){super()}set from(e){this.addChild(e)}get from(){return this.children[0]}set to(e){this.addChild(e)}get to(){return this.children[1]}set variable(e){this.addChild(e)}get variable(){return this.children[2]}isOperand(){return!0}value(){const e=this.variable.value(),t=this.from.value()||0,r=this.to.value()||e.length;return this.variable.value().slice(t,r)}}t.default=i},3573:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542)),i=n(r(5481)),u=n(r(2730));class o extends s.default{constructor(){super(...arguments),this.operators=[],this.output=[],this._alias=null,this._overridden=null,this._reducers=null}addNode(e){if(e.isOperand())this.output.push(e);else if(e.isOperator()){const t=e;for(;this.operators.length>0;){let e=this.operators[this.operators.length-1];if(!(e.precedence>t.precedence||e.precedence===t.precedence&&t.leftAssociative))break;this.output.push(e),this.operators.pop()}this.operators.push(t)}}finish(){let e;for(;e=this.operators.pop();)this.output.push(e);this.addChild(this.toTree())}toTree(){const e=this.output.pop()||new s.default;if(e.isOperator()){const t=this.toTree(),r=this.toTree();e.addChild(r),e.addChild(t)}return e}nodesAdded(){return this.operators.length>0||this.output.length>0}value(){if(null!==this._overridden)return this._overridden;if(1!==this.childCount())throw new Error("Expected one child");return this.children[0].value()}setAlias(e){this._alias=e}set alias(e){this._alias=e}get alias(){return this.firstChild()instanceof u.default&&null===this._alias?this.firstChild().identifier:this._alias}toString(){return null!==this._alias?`Expression (${this._alias})`:"Expression"}reducers(){return null===this._reducers&&(this._reducers=[...this._extract_reducers()]),this._reducers}*_extract_reducers(e=this){e instanceof i.default&&(yield e);for(const t of e.getChildren())yield*this._extract_reducers(t)}mappable(){return 0===this.reducers().length}has_reducers(){return this.reducers().length>0}set overridden(e){this._overridden=e}}t.default=o},1153:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{value(){return this.getChildren().map((e=>e.value())).join("")}}t.default=i},5196:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(3198));class i extends s.default{toString(){return`Identifier (${this._value})`}value(){return super.value()}}t.default=i},3818:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(e){super(),-1!==e.indexOf(".")?this._value=parseFloat(e):this._value=parseInt(e)}value(){return this._value}toString(){return`${this.constructor.name} (${this._value})`}}t.default=i},4783:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Is=t.Not=t.Or=t.And=t.LessThanOrEqual=t.GreaterThanOrEqual=t.LessThan=t.GreaterThan=t.NotEquals=t.Equals=t.Power=t.Modulo=t.Divide=t.Multiply=t.Subtract=t.Add=t.Operator=void 0;const s=n(r(1542));class i extends s.default{constructor(e,t){super(),this._precedence=0,this._leftAssociative=!0,this._precedence=e,this._leftAssociative=t}isOperator(){return!0}get precedence(){return this._precedence}get leftAssociative(){return this._leftAssociative}get lhs(){return this.getChildren()[0]}get rhs(){return this.getChildren()[1]}}t.Operator=i,t.Add=class extends i{constructor(){super(1,!0)}value(){return this.lhs.value()+this.rhs.value()}},t.Subtract=class extends i{constructor(){super(1,!0)}value(){return this.lhs.value()-this.rhs.value()}},t.Multiply=class extends i{constructor(){super(2,!0)}value(){return this.lhs.value()*this.rhs.value()}},t.Divide=class extends i{constructor(){super(2,!0)}value(){return this.lhs.value()/this.rhs.value()}},t.Modulo=class extends i{constructor(){super(2,!0)}value(){return this.lhs.value()%this.rhs.value()}},t.Power=class extends i{constructor(){super(3,!1)}value(){return Math.pow(this.lhs.value(),this.rhs.value())}},t.Equals=class extends i{constructor(){super(0,!0)}value(){return this.lhs.value()===this.rhs.value()?1:0}},t.NotEquals=class extends i{constructor(){super(0,!0)}value(){return this.lhs.value()!==this.rhs.value()?1:0}},t.GreaterThan=class extends i{constructor(){super(0,!0)}value(){return this.lhs.value()>this.rhs.value()?1:0}},t.LessThan=class extends i{constructor(){super(0,!0)}value(){return this.lhs.value()<this.rhs.value()?1:0}},t.GreaterThanOrEqual=class extends i{constructor(){super(0,!0)}value(){return this.lhs.value()>=this.rhs.value()?1:0}},t.LessThanOrEqual=class extends i{constructor(){super(0,!0)}value(){return this.lhs.value()<=this.rhs.value()?1:0}},t.And=class extends i{constructor(){super(-1,!0)}value(){return this.lhs.value()&&this.rhs.value()?1:0}},t.Or=class extends i{constructor(){super(-1,!0)}value(){return this.lhs.value()||this.rhs.value()?1:0}},t.Not=class extends i{constructor(){super(0,!0)}isOperator(){return!1}value(){return this.lhs.value()?0:1}},t.Is=class extends i{constructor(){super(-1,!0)}value(){return this.lhs.value()===this.rhs.value()?1:0}}},2730:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(5196));class i extends s.default{constructor(e,t=void 0){super(e),this._referred=void 0,this._referred=t}set referred(e){this._referred=e}toString(){return`Reference (${this._value})`}value(){var e;return null===(e=this._referred)||void 0===e?void 0:e.value()}get identifier(){return this._value}}t.default=i},3198:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(e){super(),this._value=e}value(){return this._value}toString(){return`String (${this._value})`}}t.default=i},5481:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(5517));class i extends s.default{constructor(e){super(e),this._overridden=null}reduce(e){throw new Error("Method not implemented.")}element(){throw new Error("Method not implemented.")}get overridden(){return this._overridden}set overridden(e){this._overridden=e}value(){return this._overridden}}t.default=i},3680:function(e,t,r){var n=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,s){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,s,(t=e[r](t)).done,t.value)}))}}},s=this&&this.__await||function(e){return this instanceof s?(this.v=e,this):new s(e)},i=this&&this.__asyncDelegator||function(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:s(e[n](t)),done:!1}:i?i(t):t}:i}},u=this&&this.__asyncGenerator||function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),u=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",(function(e){return function(t){return Promise.resolve(t).then(e,c)}})),n[Symbol.asyncIterator]=function(){return this},n;function o(e,t){i[e]&&(n[e]=function(t){return new Promise((function(r,n){u.push([e,t,r,n])>1||a(e,t)}))},t&&(n[e]=t(n[e])))}function a(e,t){try{(r=i[e](t)).value instanceof s?Promise.resolve(r.value.v).then(l,c):d(u[0][2],r)}catch(e){d(u[0][3],e)}var r}function l(e){a("next",e)}function c(e){a("throw",e)}function d(e,t){e(t),u.shift(),u.length&&a(u[0][0],u[0][1])}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=o(r(1542)),l=o(r(2312));class c extends a.default{constructor(e){super(),this._name=e}get name(){return this._name}set parameters(e){this.children=e}getArguments(){return this.children.map((e=>e.value()))}execute(){return u(this,arguments,(function*(){const e=l.default.getAsyncProvider(this._name);if(!e)throw new Error(`Async data provider '${this._name}' is not registered`);const t=e(...this.getArguments());if(t&&"function"==typeof t.next)yield s(yield*i(n(t)));else{const e=yield s(t);if(Array.isArray(e))for(const t of e)yield yield s(t);else yield yield s(e)}}))}toString(){return`AsyncFunction (${this._name})`}}t.default=c},8437:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5481)),u=s(r(1206)),o=r(3437);class a extends u.default{constructor(){super(...arguments),this._count=0,this._sum=null}get value(){return null===this._sum?null:this._sum/this._count}set value(e){this._count+=1,null!==this._sum?this._sum+=e:this._sum=e}}let l=class extends i.default{constructor(){super("avg"),this._expectedParameterCount=1}reduce(e){e.value=this.firstChild().value()}element(){return new a}};l=n([(0,o.FunctionDef)({description:"Calculates the average of numeric values across grouped rows",category:"aggregate",parameters:[{name:"value",description:"Numeric value to average",type:"number"}],output:{description:"Average of all values",type:"number",example:50},examples:["WITH [10, 20, 30] AS nums UNWIND nums AS n RETURN avg(n)"]})],l),t.default=l},1567:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5481)),u=s(r(1206)),o=r(3437);class a extends u.default{constructor(){super(...arguments),this._value=[]}get value(){return this._value}set value(e){this._value.push(e)}}class l extends u.default{constructor(){super(...arguments),this._value=new Map}get value(){return Array.from(this._value.values())}set value(e){const t=JSON.stringify(e);this._value.has(t)||this._value.set(t,e)}}let c=class extends i.default{constructor(){super("collect"),this._distinct=!1,this._expectedParameterCount=1}reduce(e){e.value=this.firstChild().value()}element(){return this._distinct?new l:new a}set distinct(e){this._distinct=e}};c=n([(0,o.FunctionDef)({description:"Collects values into an array across grouped rows",category:"aggregate",parameters:[{name:"value",description:"Value to collect",type:"any"}],output:{description:"Array of collected values",type:"array",example:[1,2,3]},examples:["WITH [1, 2, 3] AS nums UNWIND nums AS n RETURN collect(n)"]})],c),t.default=c},5517:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(e){super(),this._expectedParameterCount=null,this._supports_distinct=!1,this._name=e}set parameters(e){if(null!==this._expectedParameterCount&&this._expectedParameterCount!==e.length)throw new Error(`Function ${this._name} expected ${this._expectedParameterCount} parameters, but got ${e.length}`);this.children=e}get name(){return this._name}toString(){return`Function (${this._name})`}set distinct(e){if(!this._supports_distinct)throw new Error(`Function ${this._name} does not support distinct`);this._supports_distinct=e}}t.default=i},2312:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(5517)),i=n(r(8963));r(9854),r(1567),r(8437),r(8240),r(7514),r(3605),r(6781),r(197),r(1009),r(8673),r(2061),r(3700),r(9700),r(5940),r(2912);const u=r(3437);class o{static getAsyncProvider(e){return(0,u.getRegisteredAsyncProvider)(e.toLowerCase())}static isAsyncProvider(e){return void 0!==(0,u.getRegisteredAsyncProvider)(e.toLowerCase())}static getMetadata(e){return(0,u.getFunctionMetadata)(e.toLowerCase())}static listFunctions(e){const t=[];for(const r of(0,u.getRegisteredFunctionMetadata)())(null==e?void 0:e.category)&&r.category!==e.category||(null==e?void 0:e.asyncOnly)&&"async"!==r.category||(null==e?void 0:e.syncOnly)&&"async"===r.category||t.push(r);return t}static listFunctionNames(){return(0,u.getRegisteredFunctionMetadata)().map((e=>e.name))}static toJSON(){const e=o.listFunctions(),t=[...new Set(e.map((e=>e.category)).filter(Boolean))];return{functions:e,categories:t}}static create(e){const t=e.toLowerCase(),r=(0,u.getRegisteredFunctionFactory)(t);return r?r():new s.default(e)}static createPredicate(e){const t=e.toLowerCase(),r=(0,u.getRegisteredFunctionFactory)(t,"predicate");return r?r():new i.default(e)}}t.default=o},3437:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FunctionDef=function(e){return function(t){return"async"===e.category?r.registerAsync(t,e):r.registerFunction(t,e),t}},t.getRegisteredFunctionMetadata=function(){return r.getAllMetadata()},t.getRegisteredFunctionFactory=function(e,t){return r.getFactory(e,t)},t.getFunctionMetadata=function(e,t){return r.getMetadata(e,t)},t.getRegisteredAsyncProvider=function(e){return r.getAsyncProvider(e)};class r{static deriveDisplayName(e){const t=e.endsWith("Loader")?e.slice(0,-6):e;return t.charAt(0).toLowerCase()+t.slice(1)}static registerAsync(e,t){const r=this.deriveDisplayName(e.name),n=r.toLowerCase();this.metadata.set(n,Object.assign({name:r},t)),this.asyncProviders.set(n,((...t)=>(new e).fetch(...t)))}static registerFunction(e,t){var r;const n=(null===(r=(new e).name)||void 0===r?void 0:r.toLowerCase())||e.name.toLowerCase(),s=n.includes(":")?n.split(":")[0]:n,i=t.category?`${s}:${t.category}`:s;this.metadata.set(i,Object.assign({name:s},t)),"predicate"!==t.category&&this.factories.set(s,(()=>new e)),this.factories.set(i,(()=>new e))}static getAllMetadata(){return Array.from(this.metadata.values())}static getMetadata(e,t){const r=e.toLowerCase();if(t)return this.metadata.get(`${r}:${t}`);for(const e of this.metadata.values())if(e.name===r)return e}static getFactory(e,t){const r=e.toLowerCase();return t?this.factories.get(`${r}:${t}`):this.factories.get(r)}static getAsyncProvider(e){return this.asyncProviders.get(e.toLowerCase())}}r.metadata=new Map,r.factories=new Map,r.asyncProviders=new Map},5940:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5517)),u=s(r(2312)),o=r(3437);let a=class extends i.default{constructor(){super("functions"),this._expectedParameterCount=null}value(){const e=this.getChildren();if(0===e.length)return u.default.listFunctions();if(1===e.length){const t=e[0].value();if("string"==typeof t)return u.default.listFunctions({category:t});throw new Error("functions() category parameter must be a string")}throw new Error("functions() takes 0 or 1 parameters")}};a=n([(0,o.FunctionDef)({description:"Lists all registered functions with their metadata. Useful for discovering available functions and their documentation. Results include name, description, parameters, output schema, and usage examples.",category:"scalar",parameters:[{name:"category",description:"Optional category to filter by (e.g., 'aggregation', 'string', 'math')",type:"string",required:!1}],output:{description:"Array of function metadata objects",type:"array",items:{type:"object",properties:{name:{description:"Function name",type:"string"},description:{description:"What the function does",type:"string"},category:{description:"Function category",type:"string"},parameters:{description:"Array of parameter definitions",type:"array"},output:{description:"Output schema",type:"object"},examples:{description:"Usage examples",type:"array"}}}},examples:["WITH functions() AS funcs RETURN funcs","WITH functions('aggregation') AS funcs UNWIND funcs AS f RETURN f.name, f.description"]})],a),t.default=a},197:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5517)),u=s(r(3198)),o=r(3437);let a=class extends i.default{constructor(){super("join"),this._expectedParameterCount=2}set parameters(e){1===e.length&&e.push(new u.default("")),super.parameters=e}value(){const e=this.getChildren()[0].value(),t=this.getChildren()[1].value();if(!Array.isArray(e)||"string"!=typeof t)throw new Error("Invalid arguments for join function");return e.join(t)}};a=n([(0,o.FunctionDef)({description:"Joins an array of strings with a delimiter",category:"scalar",parameters:[{name:"array",description:"Array of values to join",type:"array"},{name:"delimiter",description:"Delimiter to join with",type:"string"}],output:{description:"Joined string",type:"string",example:"a,b,c"},examples:["WITH ['a', 'b', 'c'] AS arr RETURN join(arr, ',')"]})],a),t.default=a},1009:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5517)),u=r(3437);let o=class extends i.default{constructor(){super("keys"),this._expectedParameterCount=1}value(){const e=this.getChildren()[0].value();if(null==e)return[];if("object"!=typeof e||Array.isArray(e))throw new Error("keys() expects an object, not an array or primitive");return Object.keys(e)}};o=n([(0,u.FunctionDef)({description:"Returns the keys of an object (associative array) as an array",category:"scalar",parameters:[{name:"object",description:"Object to extract keys from",type:"object"}],output:{description:"Array of keys",type:"array",example:"['name', 'age']"},examples:["WITH { name: 'Alice', age: 30 } AS obj RETURN keys(obj)"]})],o),t.default=o},8963:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542)),i=n(r(2333));class u extends s.default{constructor(e){super(),this._valueHolder=new i.default,this._name=e}get name(){return this._name}get reference(){return this.firstChild()}get array(){return this.getChildren()[1].firstChild()}get _return(){return this.getChildren()[2]}get where(){return 4===this.getChildren().length?this.getChildren()[3]:null}value(){throw new Error("Method not implemented.")}toString(){return`PredicateFunction (${this._name})`}}t.default=u},2912:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(8963)),u=r(3437);let o=class extends i.default{constructor(){super("sum")}value(){this.reference.referred=this._valueHolder;const e=this.array.value();if(null===e||!Array.isArray(e))throw new Error("Invalid array for sum function");let t=null;for(let r=0;r<e.length;r++)this._valueHolder.holder=e[r],(null===this.where||this.where.value())&&(null===t?t=this._return.value():t+=this._return.value());return t}};o=n([(0,u.FunctionDef)({description:"Calculates the sum of values in an array with optional filtering. Uses list comprehension syntax: sum(variable IN array [WHERE condition] | expression)",category:"predicate",parameters:[{name:"variable",description:"Variable name to bind each element",type:"string"},{name:"array",description:"Array to iterate over",type:"array"},{name:"expression",description:"Expression to sum for each element",type:"any"},{name:"where",description:"Optional filter condition",type:"boolean",required:!1}],output:{description:"Sum of the evaluated expressions",type:"number",example:6},examples:["WITH [1, 2, 3] AS nums RETURN sum(n IN nums | n)","WITH [1, 2, 3, 4] AS nums RETURN sum(n IN nums WHERE n > 1 | n * 2)"]})],o),t.default=o},7514:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5517)),u=r(3437);let o=class extends i.default{constructor(){super("rand"),this._expectedParameterCount=0}value(){return Math.random()}};o=n([(0,u.FunctionDef)({description:"Generates a random number between 0 and 1",category:"scalar",parameters:[],output:{description:"Random number between 0 and 1",type:"number",example:.7234},examples:["WITH rand() AS r RETURN r"]})],o),t.default=o},8240:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5517)),u=r(3437);let o=class extends i.default{constructor(){super("range"),this._expectedParameterCount=2}value(){const e=this.getChildren()[0].value(),t=this.getChildren()[1].value();if("number"!=typeof e||"number"!=typeof t)throw new Error("Invalid arguments for range function");return Array.from({length:t-e+1},((t,r)=>e+r))}};o=n([(0,u.FunctionDef)({description:"Generates an array of sequential integers",category:"scalar",parameters:[{name:"start",description:"Starting number (inclusive)",type:"number"},{name:"end",description:"Ending number (inclusive)",type:"number"}],output:{description:"Array of integers from start to end",type:"array",items:{type:"number"},example:[1,2,3,4,5]},examples:["WITH range(1, 5) AS nums RETURN nums"]})],o),t.default=o},1206:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{get value(){throw new Error("Method not implemented.")}set value(e){throw new Error("Method not implemented.")}}},2061:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5517)),u=r(3437);let o=class extends i.default{constructor(){super("replace"),this._expectedParameterCount=3}value(){const e=this.getChildren()[0].value(),t=this.getChildren()[1].value(),r=this.getChildren()[2].value();if("string"!=typeof e||"string"!=typeof t||"string"!=typeof r)throw new Error("Invalid arguments for replace function");return e.replace(new RegExp(t,"g"),r)}};o=n([(0,u.FunctionDef)({description:"Replaces occurrences of a pattern in a string",category:"scalar",parameters:[{name:"text",description:"Source string",type:"string"},{name:"pattern",description:"Pattern to find",type:"string"},{name:"replacement",description:"Replacement string",type:"string"}],output:{description:"String with replacements",type:"string",example:"hello world"},examples:["WITH 'hello there' AS s RETURN replace(s, 'there', 'world')"]})],o),t.default=o},3605:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5517)),u=r(3437);let o=class extends i.default{constructor(){super("round"),this._expectedParameterCount=1}value(){const e=this.getChildren()[0].value();if("number"!=typeof e)throw new Error("Invalid argument for round function");return Math.round(e)}};o=n([(0,u.FunctionDef)({description:"Rounds a number to the nearest integer",category:"scalar",parameters:[{name:"value",description:"Number to round",type:"number"}],output:{description:"Rounded integer",type:"number",example:4},examples:["WITH 3.7 AS n RETURN round(n)"]})],o),t.default=o},9700:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5517)),u=r(3437);let o=class extends i.default{constructor(){super("size"),this._expectedParameterCount=1}value(){const e=this.getChildren()[0].value();if(!Array.isArray(e))throw new Error("Invalid argument for size function");return e.length}};o=n([(0,u.FunctionDef)({description:"Returns the length of an array or string",category:"scalar",parameters:[{name:"value",description:"Array or string to measure",type:"array"}],output:{description:"Length of the input",type:"number",example:3},examples:["WITH [1, 2, 3] AS arr RETURN size(arr)"]})],o),t.default=o},6781:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5517)),u=s(r(3198)),o=r(3437);let a=class extends i.default{constructor(){super("split"),this._expectedParameterCount=2}set parameters(e){1===e.length&&e.push(new u.default("")),super.parameters=e}value(){const e=this.getChildren()[0].value(),t=this.getChildren()[1].value();if("string"!=typeof e||"string"!=typeof t)throw new Error("Invalid arguments for split function");return e.split(t)}};a=n([(0,o.FunctionDef)({description:"Splits a string into an array by a delimiter",category:"scalar",parameters:[{name:"text",description:"String to split",type:"string"},{name:"delimiter",description:"Delimiter to split by",type:"string"}],output:{description:"Array of string parts",type:"array",items:{type:"string"},example:["a","b","c"]},examples:["WITH 'a,b,c' AS s RETURN split(s, ',')"]})],a),t.default=a},3700:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5517)),u=s(r(3818)),o=r(3437);let a=class extends i.default{constructor(){super("stringify"),this._expectedParameterCount=2}set parameters(e){1===e.length&&e.push(new u.default("3")),super.parameters=e}value(){const e=this.getChildren()[0].value(),t=parseInt(this.getChildren()[1].value());if("object"!=typeof e)throw new Error("Invalid argument for stringify function");return JSON.stringify(e,null,t)}};a=n([(0,o.FunctionDef)({description:"Converts a value to its JSON string representation",category:"scalar",parameters:[{name:"value",description:"Value to stringify",type:"any"}],output:{description:"JSON string",type:"string",example:'{"a":1}'},examples:["WITH {a: 1} AS obj RETURN stringify(obj)"]})],a),t.default=a},9854:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5481)),u=s(r(1206)),o=r(3437);class a extends u.default{constructor(){super(...arguments),this._value=null}get value(){return this._value}set value(e){null!==this._value?this._value+=e:this._value=e}}let l=class extends i.default{constructor(){super("sum"),this._expectedParameterCount=1}reduce(e){e.value=this.firstChild().value()}element(){return new a}};l=n([(0,o.FunctionDef)({description:"Calculates the sum of numeric values across grouped rows",category:"aggregate",parameters:[{name:"value",description:"Numeric value to sum",type:"number"}],output:{description:"Sum of all values",type:"number",example:150},examples:["WITH [1, 2, 3] AS nums UNWIND nums AS n RETURN sum(n)"]})],l),t.default=l},8673:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var s,i=arguments.length,u=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(u=(i<3?s(u):i>3?s(t,r,u):s(t,r))||u);return i>3&&u&&Object.defineProperty(t,r,u),u},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5517)),u=r(3437);let o=class extends i.default{constructor(){super("tojson"),this._expectedParameterCount=1}value(){const e=this.getChildren()[0].value();if("string"!=typeof e)throw new Error("Invalid arguments for tojson function");return JSON.parse(e)}};o=n([(0,u.FunctionDef)({description:"Parses a JSON string into an object",category:"scalar",parameters:[{name:"text",description:"JSON string to parse",type:"string"}],output:{description:"Parsed object or array",type:"object",example:{a:1}},examples:["WITH '{\"a\": 1}' AS s RETURN tojson(s)"]})],o),t.default=o},2333:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{set holder(e){this._holder=e}value(){return this._holder}}t.default=i},6052:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542)),i=n(r(1740));class u extends s.default{constructor(){super()}value(){let e=0,t=this.getChildren()[e];for(;t instanceof i.default;){const r=this.getChildren()[e+1];if(t.value())return r.value();e+=2,t=this.getChildren()[e]}return t.value()}}t.default=u},3501:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(){super()}value(){return this.getChildren()[0].value()}}t.default=i},6263:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(){super()}}t.default=i},6667:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(){super()}value(){return this.getChildren()[0].value()}}t.default=i},1740:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1542));class i extends s.default{constructor(){super()}value(){return this.getChildren()[0].value()}}t.default=i},8682:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function o(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}a((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(7342)),u=s(r(9025));class o extends i.default{constructor(){super(...arguments),this._group_by=new u.default(this.children)}run(){return n(this,void 0,void 0,(function*(){yield this._group_by.run()}))}get results(){return null!==this._where&&(this._group_by.where=this._where),Array.from(this._group_by.generate_results())}}t.default=o},6564:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function o(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}a((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(7342)),u=s(r(9025));class o extends i.default{constructor(){super(...arguments),this._group_by=new u.default(this.children)}run(){return n(this,void 0,void 0,(function*(){yield this._group_by.run()}))}finish(){const e=Object.create(null,{finish:{get:()=>super.finish}});return n(this,void 0,void 0,(function*(){var t;for(const e of this._group_by.generate_results())yield null===(t=this.next)||void 0===t?void 0:t.run();yield e.finish.call(this)}))}}t.default=o},9025:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function o(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}a((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(505));class u{constructor(e=null){this._children=new Map,this._elements=null,this._value=e}get value(){return this._value}get children(){return this._children}get elements(){return this._elements}set elements(e){this._elements=e}}class o extends i.default{constructor(){super(...arguments),this._root=new u,this._current=this._root,this._mappers=null,this._reducers=null,this._where=null}run(){return n(this,void 0,void 0,(function*(){this.resetTree(),this.map(),this.reduce()}))}get root(){return this._root}get current(){return this._current}set current(e){this._current=e}resetTree(){this.current=this.root}map(){let e=this.current;for(const t of this.mappers){const r=t.value();let n=e.children.get(r);void 0===n&&(n=new u(r),e.children.set(r,n)),e=n}this.current=e}reduce(){null===this.current.elements&&(this.current.elements=this.reducers.map((e=>e.element())));const e=this.current.elements;this.reducers.forEach(((t,r)=>{t.reduce(e[r])}))}get mappers(){return null===this._mappers&&(this._mappers=[...this._generate_mappers()]),this._mappers}*_generate_mappers(){for(const[e,t]of this.expressions())e.mappable()&&(yield e)}get reducers(){return null===this._reducers&&(this._reducers=this.children.map((e=>e.reducers())).flat()),this._reducers}*generate_results(e=0,t=this.root){var r;if(t.children.size>0)for(const r of t.children.values())this.mappers[e].overridden=r.value,yield*this.generate_results(e+1,r);else{null===(r=t.elements)||void 0===r||r.forEach(((e,t)=>{this.reducers[t].overridden=e.value}));const e={};for(const[t,r]of this.expressions())e[r]=t.value();this.where&&(yield e)}}set where(e){this._where=e}get where(){return null===this._where||this._where.value()}}t.default=o},8365:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function o(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}a((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5239));class u extends i.default{constructor(e){super(),this.count=0,this.limit=0,this.limit=e}run(){return n(this,void 0,void 0,(function*(){var e;this.count>=this.limit||(this.count++,yield null===(e=this.next)||void 0===e?void 0:e.run())}))}reset(){this.count=0}}t.default=u},1816:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function o(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}a((n=n.apply(e,t||[])).next())}))},s=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,s){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,s,(t=e[r](t)).done,t.value)}))}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const u=i(r(5239)),o=i(r(5956)),a=i(r(2457)),l=i(r(3680)),c=i(r(9798)),d=i(r(440));class h extends u.default{constructor(){super(),this._value=null}get type(){return this.children[0]}get fromComponent(){return this.children[1]}get isAsyncFunction(){return this.fromComponent.firstChild()instanceof l.default}get asyncFunction(){const e=this.fromComponent.firstChild();return e instanceof l.default?e:null}get from(){return this.children[1].value()}get headers(){return this.childCount()>2&&this.children[2]instanceof c.default&&this.children[2].value()||{}}get payload(){let e=null;return this.childCount()>2&&this.children[2]instanceof d.default?e=this.children[2]:this.childCount()>3&&this.children[3]instanceof d.default&&(e=this.children[3]),null!==e?e.firstChild():null}method(){return null===this.payload?"GET":"POST"}options(){const e=this.headers,t=this.payload,r=null==t?void 0:t.value();return null===r||"object"!=typeof r||e.hasOwnProperty("Content-Type")||(e["Content-Type"]="application/json"),Object.assign({method:this.method(),headers:e},null!==t?{body:JSON.stringify(t.value())}:{})}loadFromFunction(){return n(this,void 0,void 0,(function*(){var e,t,r,n,i;const u=this.asyncFunction;try{for(var o,a=!0,l=s(u.execute());!(e=(o=yield l.next()).done);a=!0){n=o.value,a=!1;const e=n;this._value=e,yield null===(i=this.next)||void 0===i?void 0:i.run()}}catch(e){t={error:e}}finally{try{a||e||!(r=l.return)||(yield r.call(l))}finally{if(t)throw t.error}}}))}loadFromUrl(){return n(this,void 0,void 0,(function*(){var e,t,r;const n=yield fetch(this.from,this.options());let s=null;if(this.type instanceof o.default?s=yield n.json():this.type instanceof a.default&&(s=yield n.text()),Array.isArray(s))for(const t of s)this._value=t,yield null===(e=this.next)||void 0===e?void 0:e.run();else"object"==typeof s&&null!==s?(this._value=s,yield null===(t=this.next)||void 0===t?void 0:t.run()):"string"==typeof s&&(this._value=s,yield null===(r=this.next)||void 0===r?void 0:r.run())}))}load(){return n(this,void 0,void 0,(function*(){this.isAsyncFunction?yield this.loadFromFunction():yield this.loadFromUrl()}))}run(){return n(this,void 0,void 0,(function*(){var e;try{yield this.load()}catch(t){const r=this.isAsyncFunction?null===(e=this.asyncFunction)||void 0===e?void 0:e.name:this.from;throw new Error(`Failed to load data from ${r}. Error: ${t}`)}}))}value(){return this._value}}t.default=h},5239:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function o(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}a((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(1542));class u extends i.default{constructor(){super(),this._previous=null,this._next=null}get previous(){return this._previous}set previous(e){this._previous=e}get next(){return this._next}set next(e){this._next=e}addSibling(e){var t;null===(t=this._parent)||void 0===t||t.addChild(e),e.previous=this,this.next=e}run(){return n(this,void 0,void 0,(function*(){throw new Error("Not implemented")}))}finish(){return n(this,void 0,void 0,(function*(){var e;yield null===(e=this.next)||void 0===e?void 0:e.finish()}))}reset(){}get results(){throw new Error("Not implemented")}}t.default=u},505:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(5239));class i extends s.default{constructor(e){super(),this.children=e}*expressions(){for(let e=0;e<this.children.length;e++){const t=this.children[e],r=t.alias||`expr${e}`;yield[t,r]}}}t.default=i},7342:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function o(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}a((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(505));class u extends i.default{constructor(){super(...arguments),this._where=null,this._results=[]}set where(e){this._where=e}get where(){return null===this._where||this._where.value()}run(){return n(this,void 0,void 0,(function*(){if(!this.where)return;const e=new Map;for(const[t,r]of this.expressions()){const n=t.value();e.set(r,n)}this._results.push(Object.fromEntries(e))}))}get results(){return this._results}}t.default=u},577:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function o(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}a((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5239));class u extends i.default{constructor(e){super(),this.addChild(e)}get expression(){return this.children[0]}get as(){return this.children[1].value}run(){return n(this,void 0,void 0,(function*(){var e,t;const r=this.expression.value();if(!Array.isArray(r))throw new Error("Expected array");for(let t=0;t<r.length;t++)this._value=r[t],yield null===(e=this.next)||void 0===e?void 0:e.run();null===(t=this.next)||void 0===t||t.reset()}))}value(){return this._value}}t.default=u},6001:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function o(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}a((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(5239));class u extends i.default{constructor(e){super(),this.addChild(e)}get expression(){return this.children[0]}run(){return n(this,void 0,void 0,(function*(){var e;this.expression.value()&&(yield null===(e=this.next)||void 0===e?void 0:e.run())}))}value(){return this.expression.value()}}t.default=u},696:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function o(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}a((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(505));class u extends i.default{run(){return n(this,void 0,void 0,(function*(){var e;yield null===(e=this.next)||void 0===e?void 0:e.run()}))}}t.default=u},7056:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(7342)),i=n(r(3573)),u=n(r(1542)),o=n(r(3738)),a=n(r(2312)),l=n(r(5517)),c=n(r(3680)),d=n(r(122)),h=n(r(1363)),f=n(r(2073)),p=n(r(696)),_=n(r(577)),v=n(r(6001)),E=r(4275),m=n(r(1816)),y=n(r(970)),g=n(r(5859)),w=n(r(9798)),O=n(r(6052)),x=n(r(1740)),A=n(r(3501)),R=n(r(6667)),T=n(r(9997)),k=r(4783),C=n(r(2730)),N=n(r(440)),S=n(r(8682)),b=n(r(9056)),P=n(r(5481)),D=n(r(3001)),M=n(r(7847)),I=n(r(1153)),W=n(r(3198)),L=n(r(6564)),j=n(r(5196)),F=n(r(8365)),U=n(r(3399)),H=n(r(8587));class K extends o.default{constructor(){super(...arguments),this.variables=new Map,this.context=new b.default,this._returns=0}parse(e){this.tokenize(e);const t=new u.default;let r=null,n=null;for(;!this.token.isEOF();){if(t.childCount()>0?this.expectAndSkipWhitespaceAndComments():this.skipWhitespaceAndComments(),n=this.parseOperation(),null===n)throw new Error("Expected one of WITH, UNWIND, RETURN, or LOAD");if(this._returns>1)throw new Error("Only one RETURN statement is allowed");null!==r?r.addSibling(n):t.addChild(n);const e=this.parseWhere();null!==e&&(n instanceof s.default?n.where=e:(n.addSibling(e),n=e));const i=this.parseLimit();null!==i&&(n.addSibling(i),n=i),r=n}if(!(n instanceof s.default))throw new Error("Last statement must be a RETURN or a WHERE statement");return t}parseOperation(){return this.parseWith()||this.parseUnwind()||this.parseReturn()||this.parseLoad()}parseWith(){if(!this.token.isWith())return null;this.setNextToken(),this.expectAndSkipWhitespaceAndComments();const e=Array.from(this.parseExpressions(E.AliasOption.REQUIRED));if(0===e.length)throw new Error("Expected expression");return e.some((e=>e.has_reducers()))?new L.default(e):new p.default(e)}parseUnwind(){if(!this.token.isUnwind())return null;this.setNextToken(),this.expectAndSkipWhitespaceAndComments();const e=this.parseExpression();if(null===e)throw new Error("Expected expression");if(!D.default.isInstanceOfAny(e.firstChild(),[h.default,l.default,C.default,T.default,U.default]))throw new Error("Expected array, function, reference, or lookup.");this.expectAndSkipWhitespaceAndComments();const t=this.parseAlias();if(null===t)throw new Error("Expected alias");e.setAlias(t.getAlias());const r=new _.default(e);return this.variables.set(t.getAlias(),r),r}parseReturn(){if(!this.token.isReturn())return null;this.setNextToken(),this.expectAndSkipWhitespaceAndComments();const e=Array.from(this.parseExpressions(E.AliasOption.OPTIONAL));if(0===e.length)throw new Error("Expected expression");return e.some((e=>e.has_reducers()))?new S.default(e):(this._returns++,new s.default(e))}parseWhere(){if(!this.token.isWhere())return null;this.expectPreviousTokenToBeWhitespaceOrComment(),this.setNextToken(),this.expectAndSkipWhitespaceAndComments();const e=this.parseExpression();if(null===e)throw new Error("Expected expression");if(D.default.isInstanceOfAny(e.firstChild(),[h.default,d.default]))throw new Error("Expected an expression which can be evaluated to a boolean");return new v.default(e)}parseLoad(){if(!this.token.isLoad())return null;const e=new m.default;if(this.setNextToken(),this.expectAndSkipWhitespaceAndComments(),!(this.token.isJSON()||this.token.isCSV()||this.token.isText()))throw new Error("Expected JSON, CSV, or TEXT");if(e.addChild(this.token.node),this.setNextToken(),this.expectAndSkipWhitespaceAndComments(),!this.token.isFrom())throw new Error("Expected FROM");this.setNextToken(),this.expectAndSkipWhitespaceAndComments();const t=new y.default;e.addChild(t);const r=this.parseAsyncFunction();if(null!==r)t.addChild(r);else{const e=this.parseExpression();if(null===e)throw new Error("Expected expression or async function");t.addChild(e)}if(this.expectAndSkipWhitespaceAndComments(),this.token.isHeaders()){const t=new w.default;this.setNextToken(),this.expectAndSkipWhitespaceAndComments();const r=this.parseExpression();if(null===r)throw new Error("Expected expression");t.addChild(r),e.addChild(t),this.expectAndSkipWhitespaceAndComments()}if(this.token.isPost()){const t=new N.default;this.setNextToken(),this.expectAndSkipWhitespaceAndComments();const r=this.parseExpression();if(null===r)throw new Error("Expected expression");t.addChild(r),e.addChild(t),this.expectAndSkipWhitespaceAndComments()}const n=this.parseAlias();if(null===n)throw new Error("Expected alias");return e.addChild(n),this.variables.set(n.getAlias(),e),e}parseLimit(){if(this.skipWhitespaceAndComments(),!this.token.isLimit())return null;if(this.expectPreviousTokenToBeWhitespaceOrComment(),this.setNextToken(),this.expectAndSkipWhitespaceAndComments(),!this.token.isNumber())throw new Error("Expected number");const e=new F.default(parseInt(this.token.value||"0"));return this.setNextToken(),e}*parseExpressions(e=E.AliasOption.NOT_ALLOWED){for(;;){const t=this.parseExpression();if(null===t)break;{const r=this.parseAlias();if(t.firstChild()instanceof C.default&&null===r){const e=t.firstChild();t.setAlias(e.identifier),this.variables.set(e.identifier,t)}else{if(!(e!==E.AliasOption.REQUIRED||null!==r||t.firstChild()instanceof C.default))throw new Error("Alias required");if(e===E.AliasOption.NOT_ALLOWED&&null!==r)throw new Error("Alias not allowed");[E.AliasOption.OPTIONAL,E.AliasOption.REQUIRED].includes(e)&&null!==r&&(t.setAlias(r.getAlias()),this.variables.set(r.getAlias(),t))}yield t}if(this.skipWhitespaceAndComments(),!this.token.isComma())break;this.setNextToken()}}parseExpression(){var e,t;const r=new i.default;for(;;){if(this.skipWhitespaceAndComments(),this.token.isIdentifier()&&!(null===(e=this.peek())||void 0===e?void 0:e.isLeftParenthesis())){const e=this.token.value||"",t=new C.default(e,this.variables.get(e));this.setNextToken();const n=this.parseLookup(t);r.addNode(n)}else if(this.token.isIdentifier()&&(null===(t=this.peek())||void 0===t?void 0:t.isLeftParenthesis())){const e=this.parsePredicateFunction()||this.parseFunction();if(null!==e){const t=this.parseLookup(e);r.addNode(t)}}else if(this.token.isOperand())r.addNode(this.token.node),this.setNextToken();else if(this.token.isFString()){const e=this.parseFString();if(null===e)throw new Error("Expected f-string");r.addNode(e)}else if(this.token.isLeftParenthesis()){this.setNextToken();const e=this.parseExpression();if(null===e)throw new Error("Expected expression");if(!this.token.isRightParenthesis())throw new Error("Expected right parenthesis");this.setNextToken();const t=this.parseLookup(e);r.addNode(t)}else if(this.token.isOpeningBrace()||this.token.isOpeningBracket()){const e=this.parseJSON();if(null===e)throw new Error("Expected JSON object");const t=this.parseLookup(e);r.addNode(t)}else if(this.token.isCase()){const e=this.parseCase();if(null===e)throw new Error("Expected CASE statement");r.addNode(e)}else{if(!this.token.isNot()){if(r.nodesAdded())throw new Error("Expected operand or left parenthesis");break}{const e=new k.Not;this.setNextToken();const t=this.parseExpression();if(null===t)throw new Error("Expected expression");e.addChild(t),r.addNode(e)}}if(this.skipWhitespaceAndComments(),!this.token.isOperator())break;r.addNode(this.token.node),this.setNextToken()}return r.nodesAdded()?(r.finish(),r):null}parseLookup(e){let t=e,r=null;for(;;){if(this.token.isDot()){if(this.setNextToken(),!this.token.isIdentifier()&&!this.token.isKeyword())throw new Error("Expected identifier");r=new T.default,r.index=new j.default(this.token.value||""),r.variable=t,this.setNextToken()}else{if(!this.token.isOpeningBracket())break;{this.setNextToken(),this.skipWhitespaceAndComments();const e=this.parseExpression();let n=null;if(this.skipWhitespaceAndComments(),this.token.isColon())this.setNextToken(),this.skipWhitespaceAndComments(),r=new U.default,n=this.parseExpression();else{if(null===e)throw new Error("Expected expression");r=new T.default}if(this.skipWhitespaceAndComments(),!this.token.isClosingBracket())throw new Error("Expected closing bracket");this.setNextToken(),r instanceof U.default?(r.from=e||new H.default,r.to=n||new H.default):r instanceof T.default&&null!==e&&(r.index=e),r.variable=t}}t=r||t}return t}parseCase(){if(!this.token.isCase())return null;this.setNextToken();const e=new O.default;let t=0;for(this.expectAndSkipWhitespaceAndComments();;){const r=this.parseWhen();if(null===r&&0===t)throw new Error("Expected WHEN");if(null===r&&t>0)break;null!==r&&e.addChild(r),this.expectAndSkipWhitespaceAndComments();const n=this.parseThen();if(null===n)throw new Error("Expected THEN");e.addChild(n),this.expectAndSkipWhitespaceAndComments(),t++}const r=this.parseElse();if(null===r)throw new Error("Expected ELSE");if(e.addChild(r),this.expectAndSkipWhitespaceAndComments(),!this.token.isEnd())throw new Error("Expected END");return this.setNextToken(),e}parseWhen(){if(!this.token.isWhen())return null;this.setNextToken();const e=new x.default;this.expectAndSkipWhitespaceAndComments();const t=this.parseExpression();if(null===t)throw new Error("Expected expression");return e.addChild(t),e}parseThen(){if(!this.token.isThen())return null;this.setNextToken();const e=new R.default;this.expectAndSkipWhitespaceAndComments();const t=this.parseExpression();if(null===t)throw new Error("Expected expression");return e.addChild(t),e}parseElse(){if(!this.token.isElse())return null;this.setNextToken();const e=new A.default;this.expectAndSkipWhitespaceAndComments();const t=this.parseExpression();if(null===t)throw new Error("Expected expression");return e.addChild(t),e}parseAlias(){if(this.skipWhitespaceAndComments(),!this.token.isAs())return null;if(this.expectPreviousTokenToBeWhitespaceOrComment(),this.setNextToken(),this.expectAndSkipWhitespaceAndComments(),!this.token.isIdentifier()&&!this.token.isKeyword()||null===this.token.value)throw new Error("Expected identifier");const e=new g.default(this.token.value||"");return this.setNextToken(),e}parseFunction(){var e;if(!this.token.isIdentifier())return null;if(null===this.token.value)throw new Error("Expected identifier");if(!(null===(e=this.peek())||void 0===e?void 0:e.isLeftParenthesis()))return null;const t=a.default.create(this.token.value);if(t instanceof P.default&&this.context.containsType(P.default))throw new Error("Aggregate functions cannot be nested");if(this.context.push(t),this.setNextToken(),this.setNextToken(),this.skipWhitespaceAndComments(),this.token.isDistinct()&&(t.distinct=!0,this.setNextToken(),this.expectAndSkipWhitespaceAndComments()),t.parameters=Array.from(this.parseExpressions(E.AliasOption.NOT_ALLOWED)),this.skipWhitespaceAndComments(),!this.token.isRightParenthesis())throw new Error("Expected right parenthesis");return this.setNextToken(),this.context.pop(),t}parseAsyncFunction(){var e;if(!this.token.isIdentifier())return null;if(null===this.token.value)return null;if(!a.default.isAsyncProvider(this.token.value))return null;if(!(null===(e=this.peek())||void 0===e?void 0:e.isLeftParenthesis()))return null;const t=new c.default(this.token.value);if(this.setNextToken(),this.setNextToken(),this.skipWhitespaceAndComments(),t.parameters=Array.from(this.parseExpressions(E.AliasOption.NOT_ALLOWED)),this.skipWhitespaceAndComments(),!this.token.isRightParenthesis())throw new Error("Expected right parenthesis");return this.setNextToken(),t}parsePredicateFunction(){if(!this.ahead([M.default.IDENTIFIER(""),M.default.LEFT_PARENTHESIS,M.default.IDENTIFIER(""),M.default.IN]))return null;if(null===this.token.value)throw new Error("Expected identifier");const e=a.default.createPredicate(this.token.value);if(this.setNextToken(),!this.token.isLeftParenthesis())throw new Error("Expected left parenthesis");if(this.setNextToken(),this.skipWhitespaceAndComments(),!this.token.isIdentifier())throw new Error("Expected identifier");const t=new C.default(this.token.value);if(this.variables.set(t.identifier,t),e.addChild(t),this.setNextToken(),this.expectAndSkipWhitespaceAndComments(),!this.token.isIn())throw new Error("Expected IN");this.setNextToken(),this.expectAndSkipWhitespaceAndComments();const r=this.parseExpression();if(null===r)throw new Error("Expected expression");if(!D.default.isInstanceOfAny(r.firstChild(),[h.default,C.default,T.default,l.default]))throw new Error("Expected array or reference");if(e.addChild(r),this.skipWhitespaceAndComments(),!this.token.isPipe())throw new Error("Expected pipe");this.setNextToken();const n=this.parseExpression();if(null===n)throw new Error("Expected expression");e.addChild(n);const s=this.parseWhere();if(null!==s&&e.addChild(s),this.skipWhitespaceAndComments(),!this.token.isRightParenthesis())throw new Error("Expected right parenthesis");return this.setNextToken(),this.variables.delete(t.identifier),e}parseFString(){if(!this.token.isFString())return null;const e=new I.default;for(;this.token.isFString()&&(null!==this.token.value&&e.addChild(new W.default(this.token.value)),this.setNextToken(),this.token.isOpeningBrace());){this.setNextToken();const t=this.parseExpression();if(null===t)throw new Error("Expected expression");if(e.addChild(t),!this.token.isClosingBrace())throw new Error("Expected closing brace");this.setNextToken()}return e}parseJSON(){if(this.token.isOpeningBrace()){const e=this.parseAssociativeArray();if(null===e)throw new Error("Expected associative array");return e}if(this.token.isOpeningBracket()){const e=this.parseJSONArray();if(null===e)throw new Error("Expected JSON array");return e}throw new Error("Expected opening brace or bracket")}parseAssociativeArray(){if(!this.token.isOpeningBrace())return null;const e=new d.default;for(this.setNextToken();this.skipWhitespaceAndComments(),!this.token.isClosingBrace();){if(!this.token.isIdentifier()&&!this.token.isKeyword())throw new Error("Expected identifier");const t=this.token.value;if(null===t)throw new Error("Expected string");if(this.setNextToken(),this.skipWhitespaceAndComments(),!this.token.isColon())throw new Error("Expected colon");this.setNextToken(),this.skipWhitespaceAndComments();const r=this.parseExpression();if(null===r)throw new Error("Expected expression");e.addKeyValue(new f.default(t,r)),this.skipWhitespaceAndComments(),this.token.isComma()&&this.setNextToken()}return this.setNextToken(),e}parseJSONArray(){if(!this.token.isOpeningBracket())return null;const e=new h.default;for(this.setNextToken();this.skipWhitespaceAndComments(),!this.token.isClosingBracket();){const t=this.parseExpression();if(null===t)throw new Error("Expected expression");e.addValue(t),this.skipWhitespaceAndComments(),this.token.isComma()&&this.setNextToken()}return this.setNextToken(),e}expectAndSkipWhitespaceAndComments(){if(!this.skipWhitespaceAndComments())throw new Error("Expected whitespace or comment")}skipWhitespaceAndComments(){let e=this.previousToken.isWhitespaceOrComment();for(;this.token.isWhitespace()||this.token.isComment();)this.setNextToken(),e=!0;return e}expectPreviousTokenToBeWhitespaceOrComment(){if(!this.previousToken.isWhitespaceOrComment())throw new Error("Expected whitespace or comment")}}t.default=K},8595:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(4783),i=n(r(3198)),u=n(r(5196)),o=n(r(3818)),a=n(r(1542)),l=n(r(5956)),c=n(r(3840)),d=n(r(2457)),h=n(r(1740)),f=n(r(6667)),p=n(r(3501)),_=n(r(6263)),v=n(r(8587));t.default=class{static convert(e){if(e.isNumber()){if(null===e.value)throw new Error("Number token has no value");return new o.default(e.value)}if(e.isString()){if(null===e.value)throw new Error("String token has no value");return new i.default(e.value)}if(e.isIdentifier()){if(null===e.value)throw new Error("Identifier token has no value");return new u.default(e.value)}if(e.isOperator()){if(e.isAdd())return new s.Add;if(e.isSubtract())return new s.Subtract;if(e.isMultiply())return new s.Multiply;if(e.isDivide())return new s.Divide;if(e.isModulo())return new s.Modulo;if(e.isExponent())return new s.Power;if(e.isEquals())return new s.Equals;if(e.isLessThan())return new s.LessThan;if(e.isGreaterThan())return new s.GreaterThan;if(e.isGreaterThanOrEqual())return new s.GreaterThanOrEqual;if(e.isLessThanOrEqual())return new s.LessThanOrEqual;if(e.isAnd())return new s.And;if(e.isOr())return new s.Or;if(e.isIs())return new s.Is}else if(e.isUnaryOperator()){if(e.isNot())return new s.Not}else{if(!e.isKeyword())throw new Error("Unknown token");if(e.isJSON())return new l.default;if(e.isCSV())return new c.default;if(e.isText())return new d.default;if(e.isWhen())return new h.default;if(e.isThen())return new f.default;if(e.isElse())return new p.default;if(e.isEnd())return new _.default;if(e.isNull())return new v.default}return new a.default}}},7825:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.RETURN="RETURN",e.MATCH="MATCH",e.WHERE="WHERE",e.CREATE="CREATE",e.MERGE="MERGE",e.DELETE="DELETE",e.DETACH="DETACH",e.SET="SET",e.REMOVE="REMOVE",e.FOREACH="FOREACH",e.WITH="WITH",e.CALL="CALL",e.YIELD="YIELD",e.LOAD="LOAD",e.HEADERS="HEADERS",e.POST="POST",e.FROM="FROM",e.CSV="CSV",e.JSON="JSON",e.TEXT="TEXT",e.AS="AS",e.UNWIND="UNWIND",e.SUM="SUM",e.COLLECT="COLLECT",e.DISTINCT="DISTINCT",e.ORDER="ORDER",e.BY="BY",e.ASC="ASC",e.DESC="DESC",e.SKIP="SKIP",e.LIMIT="LIMIT",e.EOF="EOF",e.CASE="CASE",e.WHEN="WHEN",e.THEN="THEN",e.ELSE="ELSE",e.END="END",e.NULL="NULL",e.IN="IN"}(r||(r={})),t.default=r},2008:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ADD="+",e.SUBTRACT="-",e.MULTIPLY="*",e.DIVIDE="/",e.MODULO="%",e.EXPONENT="^",e.EQUALS="=",e.NOT_EQUALS="<>",e.LESS_THAN="<",e.LESS_THAN_OR_EQUAL="<=",e.GREATER_THAN=">",e.GREATER_THAN_OR_EQUAL=">=",e.IS="IS",e.AND="AND",e.OR="OR",e.NOT="NOT",e.IN="IN",e.PIPE="|"}(r||(r={})),t.default=r},178:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(6519));t.default=class{constructor(e){this.text=e,this._position=0}get position(){return this._position}get currentChar(){return this.text[this.position]}get nextChar(){return this.text[this.position+1]}get previousChar(){return this.text[this.position-1]}get isAtEnd(){return this.position>=this.text.length}getString(e){return this.text.substring(e,this.position)}getRemainingString(){return this.text.substring(this.position)}checkForSingleComment(){if(this.singleLineCommentStart()){for(;!this.isAtEnd&&!this.newLine();)this._position++;return!0}return!1}checkForMultiLineComment(){if(this.multiLineCommentStart()){for(;!this.isAtEnd;){if(this.multiLineCommentEnd())return this._position+=2,!0;this._position++}throw new Error(`Unterminated multi-line comment at position ${this.position}`)}return!1}singleLineCommentStart(){return"/"===this.currentChar&&"/"===this.nextChar}multiLineCommentStart(){return"/"===this.currentChar&&"*"===this.nextChar}multiLineCommentEnd(){return"*"===this.currentChar&&"/"===this.nextChar}newLine(){return"\n"===this.currentChar}escaped(e){return"\\"===this.currentChar&&this.nextChar===e}escapedBrace(){return"{"===this.currentChar&&"{"===this.nextChar||"}"===this.currentChar&&"}"===this.nextChar}openingBrace(){return"{"===this.currentChar}closingBrace(){return"}"===this.currentChar}checkForUnderScore(){const e="_"===this.currentChar;return e&&this._position++,e}checkForLetter(){const e=s.default.letters.includes(this.currentChar.toLowerCase());return e&&this._position++,e}checkForDigit(){const e=s.default.digits.includes(this.currentChar);return e&&this._position++,e}checkForQuote(){const e=this.currentChar;return'"'===e||"'"===e||"`"===e?(this._position++,e):null}checkForString(e){const t=this.text.substring(this.position,this.position+e.length).toLowerCase()===e.toLowerCase();return t&&(this._position+=e.length),t}checkForWhitespace(){return s.default.whitespace.includes(this.currentChar)}checkForFStringStart(){return"f"===this.currentChar.toLowerCase()&&["'",'"',"`"].includes(this.nextChar)}moveNext(){this._position++}moveBy(e){this._position+=e}movePrevious(){this._position--}is_word(e){return null!==e&&this.text.substring(this.position,this.position+e.length)===e}word_continuation(e){const t=this.text[this.position+e.length];return s.default.word_valid_chars.includes(t)}}},4020:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.LEFT_PARENTHESIS="(",e.RIGHT_PARENTHESIS=")",e.COMMA=",",e.DOT=".",e.COLON=":",e.WHITESPACE="",e.OPENING_BRACE="{",e.CLOSING_BRACE="}",e.OPENING_BRACKET="[",e.CLOSING_BRACKET="]",e.BACKTICK="`"}(r||(r={})),t.default=r},7847:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(8898)),i=n(r(7825)),u=n(r(4020)),o=n(r(2008)),a=n(r(8595)),l=n(r(6519));class c{constructor(e,t=null){this._position=-1,this._case_sensitive_value=null,this._can_be_identifier=!1,this._type=e,this._value=t,this._can_be_identifier=l.default.can_be_identifier(t||"")}equals(e){return this._type===s.default.IDENTIFIER&&e.type===s.default.IDENTIFIER||this._type===e.type&&this._value===e.value}set position(e){this._position=e}get position(){return this._position}get type(){return this._type}get value(){return this._case_sensitive_value||this._value}set case_sensitive_value(e){this._case_sensitive_value=e}get can_be_identifier(){return this._can_be_identifier}get node(){return a.default.convert(this)}toString(){return`${this._type} ${this._value}`}static COMMENT(e){return new c(s.default.COMMENT,e)}isComment(){return this._type===s.default.COMMENT}static IDENTIFIER(e){return new c(s.default.IDENTIFIER,e)}isIdentifier(){return this._type===s.default.IDENTIFIER||this._type===s.default.BACKTICK_STRING}static STRING(e,t='"'){const r=l.default.unquote(e),n=l.default.removeEscapedQuotes(r,t);return new c(s.default.STRING,n)}isString(){return this._type===s.default.STRING||this._type===s.default.BACKTICK_STRING}static BACKTICK_STRING(e,t='"'){const r=l.default.unquote(e),n=l.default.removeEscapedQuotes(r,t);return new c(s.default.BACKTICK_STRING,n)}static F_STRING(e,t='"'){const r=l.default.unquote(e),n=l.default.removeEscapedQuotes(r,t),i=l.default.removeEscapedBraces(n);return new c(s.default.F_STRING,i)}isFString(){return this._type===s.default.F_STRING}static NUMBER(e){return new c(s.default.NUMBER,e)}isNumber(){return this._type===s.default.NUMBER}static get LEFT_PARENTHESIS(){return new c(s.default.SYMBOL,u.default.LEFT_PARENTHESIS)}isLeftParenthesis(){return this._type===s.default.SYMBOL&&this._value===u.default.LEFT_PARENTHESIS}static get RIGHT_PARENTHESIS(){return new c(s.default.SYMBOL,u.default.RIGHT_PARENTHESIS)}isRightParenthesis(){return this._type===s.default.SYMBOL&&this._value===u.default.RIGHT_PARENTHESIS}static get COMMA(){return new c(s.default.SYMBOL,u.default.COMMA)}isComma(){return this._type===s.default.SYMBOL&&this._value===u.default.COMMA}static get DOT(){return new c(s.default.SYMBOL,u.default.DOT)}isDot(){return this._type===s.default.SYMBOL&&this._value===u.default.DOT}static get COLON(){return new c(s.default.SYMBOL,u.default.COLON)}isColon(){return this._type===s.default.SYMBOL&&this._value===u.default.COLON}static get OPENING_BRACE(){return new c(s.default.SYMBOL,u.default.OPENING_BRACE)}isOpeningBrace(){return this._type===s.default.SYMBOL&&this._value===u.default.OPENING_BRACE}static get CLOSING_BRACE(){return new c(s.default.SYMBOL,u.default.CLOSING_BRACE)}isClosingBrace(){return this._type===s.default.SYMBOL&&this._value===u.default.CLOSING_BRACE}static get OPENING_BRACKET(){return new c(s.default.SYMBOL,u.default.OPENING_BRACKET)}isOpeningBracket(){return this._type===s.default.SYMBOL&&this._value===u.default.OPENING_BRACKET}static get CLOSING_BRACKET(){return new c(s.default.SYMBOL,u.default.CLOSING_BRACKET)}isClosingBracket(){return this._type===s.default.SYMBOL&&this._value===u.default.CLOSING_BRACKET}static get WHITESPACE(){return new c(s.default.WHITESPACE)}isWhitespace(){return this._type===s.default.WHITESPACE}isOperator(){return this._type===s.default.OPERATOR}isUnaryOperator(){return this._type===s.default.UNARY_OPERATOR}static get ADD(){return new c(s.default.OPERATOR,o.default.ADD)}isAdd(){return this._type===s.default.OPERATOR&&this._value===o.default.ADD}static get SUBTRACT(){return new c(s.default.OPERATOR,o.default.SUBTRACT)}isSubtract(){return this._type===s.default.OPERATOR&&this._value===o.default.SUBTRACT}isNegation(){return this.isSubtract()}static get MULTIPLY(){return new c(s.default.OPERATOR,o.default.MULTIPLY)}isMultiply(){return this._type===s.default.OPERATOR&&this._value===o.default.MULTIPLY}static get DIVIDE(){return new c(s.default.OPERATOR,o.default.DIVIDE)}isDivide(){return this._type===s.default.OPERATOR&&this._value===o.default.DIVIDE}static get EXPONENT(){return new c(s.default.OPERATOR,o.default.EXPONENT)}isExponent(){return this._type===s.default.OPERATOR&&this._value===o.default.EXPONENT}static get MODULO(){return new c(s.default.OPERATOR,o.default.MODULO)}isModulo(){return this._type===s.default.OPERATOR&&this._value===o.default.MODULO}static get EQUALS(){return new c(s.default.OPERATOR,o.default.EQUALS)}isEquals(){return this._type===s.default.OPERATOR&&this._value===o.default.EQUALS}static get NOT_EQUALS(){return new c(s.default.OPERATOR,o.default.NOT_EQUALS)}isNotEquals(){return this._type===s.default.OPERATOR&&this._value===o.default.NOT_EQUALS}static get LESS_THAN(){return new c(s.default.OPERATOR,o.default.LESS_THAN)}isLessThan(){return this._type===s.default.OPERATOR&&this._value===o.default.LESS_THAN}static get LESS_THAN_OR_EQUAL(){return new c(s.default.OPERATOR,o.default.LESS_THAN_OR_EQUAL)}isLessThanOrEqual(){return this._type===s.default.OPERATOR&&this._value===o.default.LESS_THAN_OR_EQUAL}static get GREATER_THAN(){return new c(s.default.OPERATOR,o.default.GREATER_THAN)}isGreaterThan(){return this._type===s.default.OPERATOR&&this._value===o.default.GREATER_THAN}static get GREATER_THAN_OR_EQUAL(){return new c(s.default.OPERATOR,o.default.GREATER_THAN_OR_EQUAL)}isGreaterThanOrEqual(){return this._type===s.default.OPERATOR&&this._value===o.default.GREATER_THAN_OR_EQUAL}static get AND(){return new c(s.default.OPERATOR,o.default.AND)}isAnd(){return this._type===s.default.OPERATOR&&this._value===o.default.AND}static get OR(){return new c(s.default.OPERATOR,o.default.OR)}isOr(){return this._type===s.default.OPERATOR&&this._value===o.default.OR}static get NOT(){return new c(s.default.UNARY_OPERATOR,o.default.NOT)}isNot(){return this._type===s.default.UNARY_OPERATOR&&this._value===o.default.NOT}static get IS(){return new c(s.default.OPERATOR,o.default.IS)}isIs(){return this._type===s.default.OPERATOR&&this._value===o.default.IS}isKeyword(){return this._type===s.default.KEYWORD}static get WITH(){return new c(s.default.KEYWORD,i.default.WITH)}isWith(){return this._type===s.default.KEYWORD&&this._value===i.default.WITH}static get RETURN(){return new c(s.default.KEYWORD,i.default.RETURN)}isReturn(){return this._type===s.default.KEYWORD&&this._value===i.default.RETURN}static get LOAD(){return new c(s.default.KEYWORD,i.default.LOAD)}isLoad(){return this._type===s.default.KEYWORD&&this._value===i.default.LOAD}static get JSON(){return new c(s.default.KEYWORD,i.default.JSON)}isJSON(){return this._type===s.default.KEYWORD&&this._value===i.default.JSON}static get CSV(){return new c(s.default.KEYWORD,i.default.CSV)}isCSV(){return this._type===s.default.KEYWORD&&this._value===i.default.CSV}static get TEXT(){return new c(s.default.KEYWORD,i.default.TEXT)}isText(){return this._type===s.default.KEYWORD&&this._value===i.default.TEXT}static get FROM(){return new c(s.default.KEYWORD,i.default.FROM)}isFrom(){return this._type===s.default.KEYWORD&&this._value===i.default.FROM}static get HEADERS(){return new c(s.default.KEYWORD,i.default.HEADERS)}isHeaders(){return this._type===s.default.KEYWORD&&this._value===i.default.HEADERS}static get POST(){return new c(s.default.KEYWORD,i.default.POST)}isPost(){return this._type===s.default.KEYWORD&&this._value===i.default.POST}static get UNWIND(){return new c(s.default.KEYWORD,i.default.UNWIND)}isUnwind(){return this._type===s.default.KEYWORD&&this._value===i.default.UNWIND}static get MATCH(){return new c(s.default.KEYWORD,i.default.MATCH)}isMatch(){return this._type===s.default.KEYWORD&&this._value===i.default.MATCH}static get AS(){return new c(s.default.KEYWORD,i.default.AS)}isAs(){return this._type===s.default.KEYWORD&&this._value===i.default.AS}static get WHERE(){return new c(s.default.KEYWORD,i.default.WHERE)}isWhere(){return this._type===s.default.KEYWORD&&this._value===i.default.WHERE}static get MERGE(){return new c(s.default.KEYWORD,i.default.MERGE)}isMerge(){return this._type===s.default.KEYWORD&&this._value===i.default.MERGE}static get CREATE(){return new c(s.default.KEYWORD,i.default.CREATE)}isCreate(){return this._type===s.default.KEYWORD&&this._value===i.default.CREATE}static get DELETE(){return new c(s.default.KEYWORD,i.default.DELETE)}isDelete(){return this._type===s.default.KEYWORD&&this._value===i.default.DELETE}static get SET(){return new c(s.default.KEYWORD,i.default.SET)}isSet(){return this._type===s.default.KEYWORD&&this._value===i.default.SET}static get REMOVE(){return new c(s.default.KEYWORD,i.default.REMOVE)}isRemove(){return this._type===s.default.KEYWORD&&this._value===i.default.REMOVE}static get CASE(){return new c(s.default.KEYWORD,i.default.CASE)}isCase(){return this._type===s.default.KEYWORD&&this._value===i.default.CASE}static get WHEN(){return new c(s.default.KEYWORD,i.default.WHEN)}isWhen(){return this._type===s.default.KEYWORD&&this._value===i.default.WHEN}static get THEN(){return new c(s.default.KEYWORD,i.default.THEN)}isThen(){return this._type===s.default.KEYWORD&&this._value===i.default.THEN}static get ELSE(){return new c(s.default.KEYWORD,i.default.ELSE)}isElse(){return this._type===s.default.KEYWORD&&this._value===i.default.ELSE}static get END(){return new c(s.default.KEYWORD,i.default.END)}isEnd(){return this._type===s.default.KEYWORD&&this._value===i.default.END}static get NULL(){return new c(s.default.KEYWORD,i.default.NULL)}isNull(){return this._type===s.default.KEYWORD&&this._value===i.default.NULL}static get IN(){return new c(s.default.KEYWORD,i.default.IN)}isIn(){return this._type===s.default.KEYWORD&&this._value===i.default.IN}static get PIPE(){return new c(s.default.KEYWORD,o.default.PIPE)}isPipe(){return this._type===s.default.KEYWORD&&this._value===o.default.PIPE}static get DISTINCT(){return new c(s.default.KEYWORD,i.default.DISTINCT)}isDistinct(){return this._type===s.default.KEYWORD&&this._value===i.default.DISTINCT}static get LIMIT(){return new c(s.default.KEYWORD,i.default.LIMIT)}isLimit(){return this._type===s.default.KEYWORD&&this._value===i.default.LIMIT}static get EOF(){return new c(s.default.EOF)}isEOF(){return this._type===s.default.EOF}isOperand(){return this.isNumber()||this.isString()||this.isNull()}isWhitespaceOrComment(){return this.isWhitespace()||this.isComment()}isSymbol(){return this._type===s.default.SYMBOL}static method(e){return c[e.toUpperCase()]}}t.default=c},299:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(7847)),i=n(r(8652));t.default=class{constructor(e){this._enum=e,this._trie=new i.default;for(const[t,r]of Object.entries(e)){const e=s.default.method(t);void 0!==e&&null!==e.value&&this._trie.insert(e)}}map(e){return this._trie.find(e)}get last_found(){return this._trie.last_found}}},8898:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.KEYWORD="KEYWORD",e.OPERATOR="OPERATOR",e.UNARY_OPERATOR="UNARY_OPERATOR",e.IDENTIFIER="IDENTIFIER",e.STRING="STRING",e.F_STRING="F-STRING",e.BACKTICK_STRING="BACKTICK_STRING",e.NUMBER="NUMBER",e.SYMBOL="SYMBOL",e.WHITESPACE="WHITESPACE",e.COMMENT="COMMENT",e.EOF="EOF"}(r||(r={})),t.default=r},3479:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(7825)),i=n(r(7847)),u=n(r(178)),o=n(r(6519)),a=n(r(4020)),l=n(r(2008)),c=n(r(299));t.default=class{constructor(e){this.keywords=new c.default(s.default),this.symbols=new c.default(a.default),this.operators=new c.default(l.default),this.walker=new u.default(e)}tokenize(){const e=[];let t=null;for(;!this.walker.isAtEnd;){e.push(...this.f_string()),t=this.getLastNonWhitespaceOrNonCommentToken(e)||t;const r=this.getNextToken(t);if(null===r)throw new Error(`Unrecognized token at position ${this.walker.position}`);r.position=this.walker.position,e.push(r)}return e}getLastNonWhitespaceOrNonCommentToken(e){return 0===e.length||e[e.length-1].isWhitespaceOrComment()?null:e[e.length-1]}getNextToken(e=null){return this.walker.isAtEnd?i.default.EOF:this.comment()||this.whitespace()||this.lookup(this.keywords)||this.lookup(this.operators,e,this.skipMinus)||this.identifier()||this.string()||this.number()||this.lookup(this.symbols)}comment(){const e=this.walker.position;if(this.walker.checkForSingleComment()||this.walker.checkForMultiLineComment()){const t=o.default.uncomment(this.walker.getString(e));return i.default.COMMENT(t)}return null}identifier(){const e=this.walker.position;if(this.walker.checkForUnderScore()||this.walker.checkForLetter()){for(;!this.walker.isAtEnd&&(this.walker.checkForLetter()||this.walker.checkForDigit()||this.walker.checkForUnderScore()););return i.default.IDENTIFIER(this.walker.getString(e))}return null}string(){const e=this.walker.position,t=this.walker.checkForQuote();if(null===t)return null;for(;!this.walker.isAtEnd;)if(this.walker.escaped(t))this.walker.moveNext(),this.walker.moveNext();else{if(this.walker.checkForString(t)){const r=this.walker.getString(e);return t===a.default.BACKTICK?i.default.BACKTICK_STRING(r,t):i.default.STRING(r,t)}this.walker.moveNext()}throw new Error(`Unterminated string at position ${e}`)}*f_string(){if(!this.walker.checkForFStringStart())return;this.walker.moveNext();let e=this.walker.position;const t=this.walker.checkForQuote();if(null!==t)for(;!this.walker.isAtEnd;)if(this.walker.escaped(t)||this.walker.escapedBrace())this.walker.moveNext(),this.walker.moveNext();else{if(this.walker.openingBrace())for(yield i.default.F_STRING(this.walker.getString(e),t),e=this.walker.position,yield i.default.OPENING_BRACE,this.walker.moveNext(),e=this.walker.position;!this.walker.isAtEnd&&!this.walker.closingBrace();){const t=this.getNextToken();if(null===t)break;if(yield t,this.walker.closingBrace()){yield i.default.CLOSING_BRACE,this.walker.moveNext(),e=this.walker.position;break}}if(this.walker.checkForString(t))return void(yield i.default.F_STRING(this.walker.getString(e),t));this.walker.moveNext()}}whitespace(){let e=!1;for(;!this.walker.isAtEnd&&this.walker.checkForWhitespace();)this.walker.moveNext(),e=!0;return e?i.default.WHITESPACE:null}number(){const e=this.walker.position;if(this.walker.checkForString("-")||this.walker.checkForDigit()){for(;!this.walker.isAtEnd&&this.walker.checkForDigit(););if(this.walker.checkForString(a.default.DOT))for(;!this.walker.isAtEnd&&this.walker.checkForDigit(););const t=this.walker.getString(e);return i.default.NUMBER(t)}return null}lookup(e,t=null,r){const n=e.map(this.walker.getRemainingString());return void 0!==n&&null!==n.value?n.can_be_identifier&&this.walker.word_continuation(n.value)||r&&t&&r(t,n)?null:(this.walker.moveBy(n.value.length),null!==e.last_found&&(n.case_sensitive_value=e.last_found),n):null}skipMinus(e,t){return null!==e&&!(!(e.isKeyword()||e.isComma()||e.isColon())||!t.isNegation())}}},8652:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this._children=new Map,this._token=void 0}map(e){return this._children.get(e)||this._children.set(e,new r).get(e)}retrieve(e){return this._children.get(e)}set token(e){this._token=e}get token(){return this._token}is_end_of_word(){return void 0!==this._token}no_children(){return 0===this._children.size}}t.default=class{constructor(){this._root=new r,this._max_length=0,this._last_found=null}insert(e){if(null===e.value||0===e.value.length)throw new Error("Token value cannot be null or empty");let t=this._root;for(const r of e.value)t=t.map(r.toLowerCase());e.value.length>this._max_length&&(this._max_length=e.value.length),t.token=e}find(e){if(0===e.length)return;let t,r,n=0;for(this._last_found=null;void 0!==(t=(t||this._root).retrieve(e[n].toLowerCase()))&&(t.is_end_of_word()&&(r=t.token,this._last_found=e.substring(0,n+1)),n++,!(n===e.length||n>this._max_length)););return(null==t?void 0:t.is_end_of_word())&&(r=t.token,this._last_found=e.substring(0,n)),r}get last_found(){return this._last_found}}},3001:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{static isInstanceOfAny(e,t){return t.some((t=>e instanceof t))}}},6519:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class r{static unquote(e){if(0===e.length)return e;if(1===e.length&&r.quotes.includes(e))return"";const t=e[0],n=e[e.length-1];return r.quotes.includes(t)&&t===n?e.substring(1,e.length-1):r.quotes.includes(n)&&t!==n?e.substring(0,e.length-1):r.quotes.includes(t)&&t!==n?e.substring(1):e}static uncomment(e){return e.length<2?e:"/"===e[0]&&"/"===e[1]?e.substring(2):"/"===e[0]&&"*"===e[1]&&"*"===e[e.length-2]&&"/"===e[e.length-1]?e.substring(2,e.length-2):e}static removeEscapedQuotes(e,t){let r="";for(let n=0;n<e.length;n++)"\\"===e[n]&&e[n+1]===t&&n++,r+=e[n];return r}static removeEscapedBraces(e){let t="";for(let r=0;r<e.length;r++)("{"===e[r]&&"{"===e[r+1]||"}"===e[r]&&"}"===e[r+1])&&r++,t+=e[r];return t}static can_be_identifier(e){const t=e.toLowerCase();return 0!==t.length&&!(!r.letters.includes(t[0])&&"_"!==t[0])&&t.split("").every((e=>r.word_valid_chars.includes(e)))}}r.quotes=['"',"'","`"],r.letters="abcdefghijklmnopqrstuvwxyz",r.digits="0123456789",r.whitespace=" \t\n\r",r.word_valid_chars=r.letters+r.digits+"_",t.default=r}},t={},r=function r(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}(610);return r.default})()));